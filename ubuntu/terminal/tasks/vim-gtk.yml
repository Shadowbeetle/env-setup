- name: Install vim-gtk
  become: yes
  apt:
    name:
      - vim-gtk
    state: present

- name: Setup variables
  set_fact:
    link_target: "{{ dotfiles_path }}/vim/dot-vimrc"
    backup_path: ~/.vimrc.back
    config_path: ~/.vimrc

- name: Ensure dotfiles are up to date
  include: dotfiles.yml

- name: Check if "{{ backup_path }}" already exists
  stat: 
    path: "{{ backup_path }}"
  register: backup_stat

- name: Fail if "{{ backup_path }}" already exists
  fail:
    msg: "{{ backup_path }} already exists, refusing to continue"
  when: backup_stat.stat.exists

- name: Back up existing "{{ config_path }}"
  shell: |
    if [ ! -L "{{ config_path }}" ] && [ -f "{{ config_path }}" ]
    then 
      mv "{{ config_path }}" "{{ backup_path }}"
    fi

- name: Setup "{{ config_path }}"
  file:
    state: link
    src: "{{ link_target }}"
    dest: "{{ config_path }}"

- name: Install vim-plug
  shell: curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
